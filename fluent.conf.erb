<source>
  type udp
  format json
  tag udp
  port 5160
  bind 0.0.0.0
  body_size_limit 1MB
</source>

<match **>
  type copy

  <% if ENV["ELASTICSEARCH_HOST"] %>
    <store>
      type elasticsearch
      logstash_format true
      host <%= ENV["ELASTICSEARCH_HOST"] %>
      port <%= ENV["ELASTICSEARCH_PORT"] %>
      flush_interval 10
    </store>
  <% end %>

  <% if ENV["LOGGLY_TOKEN"] %>
    <store>
      type loggly
      loggly_url https://logs-01.loggly.com/inputs/<%= ENV["LOGGLY_TOKEN"] %>/tag/fluentd
    </store>
  <% end %>

  <% if ENV["S3_BUCKET"] %>
    <store>
      type s3
      aws_key_id <%= ENV["AWS_KEY"] %>
      aws_sec_key <%= ENV["AWS_SECRET"] %>
      s3_bucket <%= ENV["S3_BUCKET"] %>
      s3_endpoint <%= ENV["S3_ENDPOINT"] %>
      path <%= ENV["S3_PATH"] %>
      buffer_path /tmp
      time_slice_format %Y-%m-%d/%H
      time_slice_wait 10m
    </store>
  <% end %>
</match>
