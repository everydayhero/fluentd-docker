---
steps:
  - name: ":rspec:"
    command: "bin/ci"

  - type: waiter

  - name: ":docker: Build Image"
    command: bin/build

  - type: waiter

  - name: ":docker: Tag Staging"
    command: bin/tag staging
    branches: master

  - type: manual

  - name: ":ansible: Deploy"
    command: "plain-utils ansible-playbook $ENVIRONMENT master bootstrap.yml --tags fluentd"
    branches: master
    env:
      ENVIRONMENT: staging

  - type: manual

  - name: ":docker: Tag Production"
    command: bin/tag production
    branches: master

  - type: waiter

  - name: ":ansible: Deploy"
    command: "plain-utils ansible-playbook $ENVIRONMENT master bootstrap.yml --tags fluentd"
    branches: master
    env:
      ENVIRONMENT: production
